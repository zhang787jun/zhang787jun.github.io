<!DOCTYPE HTML>
<html>

<head>
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <title>01 媒体服务基础 - Jun's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Wiki" />
    <meta name="description" content="A wiki website" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            }
        });
    </script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
</head>

<body>

    <div id="container">
        
<div id="header">
  <div id="post-nav"><a href="/Wiki/">Home</a>&nbsp;»&nbsp;<a href="/Wiki/#Computer_Vision">Computer_Vision</a>&nbsp;»&nbsp;<a href="/Wiki/#-Media_Server">Media_Server</a>&nbsp;»&nbsp;01 媒体服务基础</div>
</div>
<div class="clearfix"></div>
<div id="title">01 媒体服务基础</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#1">1. 什么是（流）媒体服务</a></li>
<li><a href="#2">2. 功能</a></li>
<li><a href="#3">3. 典型的解决方案</a><ul>
<li><a href="#31-windows-media-service">3.1. Windows Media Service</a></li>
<li><a href="#32-helix-server">3.2. Helix Server</a></li>
<li><a href="#33-flash-media-server">3.3. Flash Media Server</a></li>
<li><a href="#34-darwin-streaming-server">3.4. Darwin Streaming Server</a></li>
<li><a href="#35-rtsp-server">3.5. rtsp-server</a></li>
</ul>
</li>
<li><a href="#4">4. 云解决方案</a><ul>
<li><a href="#41-jasonriversnginx-rtmp">4.1. jasonrivers/nginx-rtmp</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="1">1. 什么是（流）媒体服务</h1>
<p>A  Media Server is a computer appliance or an application software that stores digital media (video, audio or images) and makes it available over a network.</p>
<p><img alt="" src="https://docs.microsoft.com/zh-cn/azure/media-services/latest/media/live-streaming/live-encoding.svg" /></p>
<h1 id="2">2. 功能</h1>
<p><img alt="" src="https://img-blog.csdnimg.cn/20190422113053807.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9odWF3ZWljbG91ZC5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" /></p>
<p>流媒体服务器最主要功能是：<br />
1. <strong>拉流</strong>。以流式协议（RTP/RTSP、MMS、RTMP等）将视频文件传输到客户端，供用户在线观看；<br />
2. <strong>推流</strong>。</p>
<p>其他功能：<br />
1. 用户安全管理<br />
2. 内容分发加速<br />
3. 媒体存储</p>
<h1 id="3">3. 典型的解决方案</h1>
<h2 id="31-windows-media-service">3.1. Windows Media Service</h2>
<p>微软的Windows Media Service（WMS），它采用MMS协议接收、传输视频，采用Windows Media Player（WMP）作为前端播放器；</p>
<h2 id="32-helix-server">3.2. Helix Server</h2>
<p>RealNetworks公司的Helix Server，采用RTP/RTSP协议接收、传输视频，采用Real Player作为播放前端；</p>
<h2 id="33-flash-media-server">3.3. Flash Media Server</h2>
<p>Adobe公司的Flash Media Server,采用RTMP(RTMPT/RTMPE/RTMPS)协议接收、传输视频，采用Flash Player作为播放前端。值得注意的是，随着Adobe公司的Flash播放器的普及（根据Adobe官方数据，Flash播放器装机量已高达99%以上），越来越多的网络视频开始采用Flash播放器作为播放前端，因此，越来越多的企业开始采用兼容Flash播放器的流媒体服务器，而开始淘汰其他类型的流媒体服务器。支持Flash播放器的流媒体服务器，除了Adobe Flash Media Server，还有sewise的流媒体服务器软件和Ultrant Flash Media Server流媒体服务器软件，以及基于Java语言的开源软件Red5。</p>
<h2 id="34-darwin-streaming-server">3.4. Darwin Streaming Server</h2>
<p>Darwin Streaming Server简称DSS。DSS是Apple公司提供的开源实时流媒体播放服务器程序。整个程序使用C++编写，在设计上遵循高性能，简单，模块化等程序设计原则，务求做到程序高效，可扩充性好。并且DSS是一个开放源代码的，基于标准的流媒体服务器，可以运行在Windows NT和Windows 2000，以及几个UNIX实现上，包括Mac OS X，Linux，FreeBSD，和Solaris操作系统上的。</p>
<h2 id="35-rtsp-server">3.5. rtsp-server</h2>
<p><a href="https://github.com/revmischa/rtsp-server">rtsp-server</a> 一般是指 revmischa 写的一个开源的轻量级RTSP/RTP 流媒体服务 (Lightweight RTSP/RTP streaming media server)</p>
<p>fmpeg h264转码，并且使用rtps推流</p>
<p>.DDDD 2020-05-19 16:25:18  603  收藏 1<br />
文章标签： ffmpeg linux<br />
版权<br />
ffmpeg h264转码，并且使用rtps推流<br />
先说说rtmp推流：</p>
<p>ffmpeg推流rtmp:</p>
<p>各大网站都能很简单的找到<br />
ffmpeg -i “rtsp://admin:Gdkt_2019@172.0.0.1554/ch1/main/av_stream” -vcodec copy -acodec copy -f flv “rtmp://127.0.0.1:1935/live/”</p>
<p>ffmpeg推流rtsp：<br />
这个需要去到ffmpeg的官方文档才能找到<br />
https://www.ffmpeg.org/ffmpeg-all.html#Examples-19</p>
<p>RTSP推流，实操：<br />
LINUX环境<br />
ffmpeg推流，特点：高延迟低消耗<br />
推流rtsp<br />
下载安装rtsp-server<br />
https://github.com/revmischa/rtsp-server</p>
<p>启动后使用命令行推流<br />
ffmpeg -max_delay 100 -r 25 -re -i “rtsp url(这里是拉流地址或者视频地址)” -b 700000 -rtsp_transport tcp -s 704*576 -vcodec h264 -f rtsp rtsp://localhost/test</p>
<p>-r 是你设置的帧数<br />
-s是设置的图像大小<br />
该命令可以解决h264转码后花屏的问题</p>
<p>WINDOWS环境<br />
下载EasyDarwin开源流媒体服务器<br />
https://github.com/EasyDarwin/EasyDarwin</p>
<p>启动后也是使用相同的命令进行推流</p>
<p>拉流方式: ffplay rtsp://localhost/test</p>
<p>VLC搭建rstp服务器<br />
特点：低延迟高消耗</p>
<p>1)和上面一样开始rtps-server<br />
2)参考此文章：https://blog.csdn.net/qq_29350001/article/details/77979355</p>
<p>Gstreamer 搭建RTSP服务器</p>
<p>树叶-梨花 2019-08-12 17:08:18  4369  收藏 4<br />
分类专栏： Gstreamer 学习笔记 文章标签： RtspServer RtspClient Rtsp服务器<br />
版权<br />
摘要<br />
基于Gstreamer搭建Rtsp Server并不是基于gst-launch方式，而是额外提供了一个工程。工程git地址：git clone git://anongit.freedesktop.org/gstreamer/gst-rtsp-server 这是因为gst-rtsp-server不是以plugin的形式存在，如果您需要基于Gstreamer构建Rtsp Server，则需要同步上述工程，进行本地编译。</p>
<p>工程编译<br />
预先准备：</p>
<p>1、Install gstreamer-1.0 with base/good/ugly/bad plugins<br />
2、Install autoconf automake autopoint libtool and the other missing essential build tools</p>
<p>编译命令：<br />
1、 cd gst-rtsp-server<br />
2、./autogen.sh<br />
3、如果第执行步骤2没出错，则跳过此步骤。如果出错，并类似如下的错误提示，则需进行版本切换。</p>
<p>.......<br />
checking for glib-mkenums... glib-mkenums<br />
checking for GIO... yes<br />
checking for GST... no<br />
configure: Requested 'gstreamer-1.0 &gt;= 1.17.0.1' but version of GStreamer is 1.8.3<br />
configure: error: no gstreamer-1.0 &gt;= 1.17.0.1 (GStreamer) found<br />
1<br />
2<br />
3<br />
4<br />
5<br />
6<br />
版本切换方法：</p>
<p>查看所有版本分支：git branch -av<br />
在这里插入图片描述<br />
切换到目标版本（笔者是1.8）：git checkout remotes/origin/1.8 -b version1.8 “version1.8”为笔者自定义的分支名称。执行成功后，再次执行git branch -av查看分支是否切换成功？<br />
在这里插入图片描述<br />
然后再次执行步骤2，如果提示缺少什么包，则使用apt-get install安装相应包即可。<br />
遇到缺少包错误及解决办法：</p>
<p>错误1</p>
<p>configure: error: You need to have gtk-doc &gt;= 1.12 installed to build<br />
GStreamer RTSP Server Library configure failed</p>
<p>解决办法：sudo apt-get install gtk-doc-tools</p>
<p>错误2</p>
<p>configure: No package ‘gstreamer-plugins-base-1.0’ found configure:<br />
error: no gstreamer-plugins-base-1.0 &gt;= 1.8.0 (GStreamer Base Plugins)<br />
found configure failed</p>
<p>解决办法：sudo apt-get install libgstreamer-plugins-base1.0-dev libgstreamer-plugins-good1.0-dev libgstreamer-plugins-bad1.0-dev</p>
<p>4、执行编译命令：make</p>
<p>注：要注意查看有没有提示编译错误信息，根据错误信息进行对症下药（一般是缺其它依赖库）。</p>
<p>效果演示<br />
1、切换到examples目录：cd examples<br />
2、搭建Rtsp Server：./test-launch "( videotestsrc ! x264enc ! rtph264pay name=pay0 pt=96 )"<br />
3、播放rtsp流：gst-launch-1.0 playbin uri=rtsp://127.0.0.1:8554/test<br />
在这里插入图片描述</p>
<p>注：笔者的rtsp server 与 client的播放均在同一台PC，因此可以使用127.0.0.1，不同需求可更改IP地址进行适配。</p>
<h1 id="4">4. 云解决方案</h1>
<h2 id="41-jasonriversnginx-rtmp">4.1. jasonrivers/nginx-rtmp</h2>
<p>ffmpeg推送阿里云流媒体服务器脚本</p>
<p>阿里云的推流域名是有安全认证的，所我们在处理推流地址时需要获取时间戳并且计算过期时间再进行MD5加密，这么做主要是为了防止所有人都可向你的服务器推流造成流量经济损失！</p>
<p>首先左羊先大家从ffmepg命令逐级讲解：</p>
<div class="hlcode"><pre><span class="n">ffmpeg</span> <span class="o">-</span><span class="n">re</span> <span class="o">-</span><span class="n">rtsp_transport</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">i</span> <span class="err">$</span><span class="n">rtspUrl</span> <span class="o">-</span><span class="n">c</span><span class="o">:</span><span class="n">a</span> <span class="n">copy</span> <span class="o">-</span><span class="n">c</span><span class="o">:</span><span class="n">v</span> <span class="n">libx264</span> <span class="o">-</span><span class="n">preset</span><span class="o">:</span><span class="n">v</span> <span class="n">fast</span> <span class="o">-</span><span class="n">tune</span><span class="o">:</span><span class="n">v</span> <span class="n">zerolatency</span> <span class="o">-</span><span class="n">max_delay</span> <span class="mi">100</span> <span class="o">-</span><span class="n">f</span> <span class="n">flv</span> <span class="o">-</span><span class="n">g</span> <span class="mi">5</span> <span class="o">-</span><span class="n">b</span> <span class="mi">1024</span><span class="n">k</span> <span class="err">$</span><span class="n">rtmpUrl</span>
</pre></div>


<p>$rtspUrl：rtsp抓流地址<br />
$rtmpUrl：rtmp推流地址<br />
我在这里主要说下rtmp推流地址的组成方式</p>
<div class="hlcode"><pre><span class="err">$</span><span class="n">rtmp2</span><span class="err">&#39;</span><span class="o">?</span><span class="n">auth_key</span><span class="o">=</span><span class="err">&#39;$</span><span class="n">timestamp</span><span class="err">&#39;</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="err">&#39;$</span><span class="n">md5Str2</span>
<span class="err">$</span><span class="n">rtmp2</span><span class="err">：</span><span class="n">rtmp</span><span class="err">推流域名</span>
<span class="err">$</span><span class="n">timestamp</span><span class="o">:</span><span class="err">过期时间戳</span>
<span class="err">$</span><span class="n">md5Str2</span><span class="err">：</span><span class="n">MD5</span><span class="err">加密串</span>
<span class="err">过期时间戳</span>

<span class="cp">#获取当前时间戳</span>
<span class="n">current</span><span class="o">=</span><span class="err">`</span><span class="n">date</span> <span class="s">&quot;+%Y-%m-%d %H:%M:%S&quot;</span><span class="err">`</span>
<span class="n">timeStampStr</span><span class="o">=</span><span class="err">`</span><span class="n">date</span> <span class="o">-</span><span class="n">d</span> <span class="s">&quot;$current&quot;</span> <span class="o">+%</span><span class="n">s</span><span class="err">`</span> 
<span class="n">timestamp</span><span class="o">=</span><span class="err">$</span><span class="p">((</span><span class="n">timeStampStr</span><span class="o">*</span><span class="mi">1000</span><span class="o">+</span><span class="err">`</span><span class="n">date</span> <span class="s">&quot;+%N&quot;</span><span class="err">`</span><span class="o">/</span><span class="mi">1000000</span><span class="o">/</span><span class="mi">1000</span><span class="o">+</span><span class="mi">1800</span><span class="p">))</span> <span class="err">#将</span><span class="n">timeStampStr</span><span class="err">转换为过期时间戳，精确到毫</span>
<span class="n">MD5</span><span class="err">加密串</span>

<span class="n">md5Url2</span><span class="o">=</span><span class="sc">&#39;/&#39;</span><span class="err">$</span><span class="n">appName</span><span class="err">&#39;</span><span class="o">/</span><span class="mi">202</span><span class="o">-</span><span class="err">&#39;$</span><span class="n">timestamp</span><span class="err">&#39;</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="err">&#39;$</span><span class="n">pushIdentKey</span>
<span class="n">md5Str2</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="err">$</span><span class="n">md5Url2</span> <span class="o">|</span> <span class="n">md5sum</span> <span class="o">|</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">}</span><span class="err">&#39;</span><span class="p">)</span>
</pre></div>


<p>最后附上完整脚本</p>
<div class="hlcode"><pre><span class="c">#!/bin/sh</span>
<span class="c">#备注:强烈杜绝中文标点符号</span>
<span class="c">#摄像头数量</span>
<span class="nv">cameNum</span><span class="o">=</span>6
<span class="c">#摄像头推流</span>
<span class="nv">came1</span><span class="o">=</span><span class="s1">&#39;rtsp://网络摄像头地址1&#39;</span>
<span class="nv">came2</span><span class="o">=</span><span class="s1">&#39;rtsp://网络摄像头地址2&#39;</span>
<span class="nv">came3</span><span class="o">=</span><span class="s1">&#39;rtsp://网络摄像头地址3&#39;</span>
<span class="nv">came4</span><span class="o">=</span><span class="s1">&#39;rtsp://网络摄像头地址4&#39;</span>
<span class="nv">came5</span><span class="o">=</span><span class="s1">&#39;rtsp://网络摄像头地址5&#39;</span>
<span class="nv">came6</span><span class="o">=</span><span class="s1">&#39;rtsp://网络摄像头地址6&#39;</span>

<span class="c">#获取当前时间戳</span>
<span class="nv">current</span><span class="o">=</span><span class="sb">`</span>date <span class="s2">&quot;+%Y-%m-%d %H:%M:%S&quot;</span><span class="sb">`</span>
<span class="nv">timeStampStr</span><span class="o">=</span><span class="sb">`</span>date -d <span class="s2">&quot;$current&quot;</span> +%s<span class="sb">`</span> 
<span class="nv">timestamp</span><span class="o">=</span><span class="k">$((</span>timeStampStr*1000+<span class="sb">`</span>date <span class="s2">&quot;+%N&quot;</span><span class="sb">`</span><span class="o">/</span><span class="m">1000000</span><span class="o">/</span><span class="m">1000</span><span class="o">+</span><span class="m">1800</span><span class="k">))</span> <span class="c">#将timeStampStr转换为过期时间戳，精确到毫秒</span>

<span class="c">#阿里云推流地址</span>
<span class="nv">Url</span><span class="o">=</span><span class="s1">&#39;阿里云推流地址&#39;</span>
<span class="c">#拉流名称</span>
<span class="nv">appName</span><span class="o">=</span><span class="s1">&#39;live&#39;</span>
<span class="c">#阿里云推流Key</span>
<span class="nv">pushIdentKey</span><span class="o">=</span><span class="s1">&#39;阿里云推流Key&#39;</span>

<span class="c">#推流地址</span>
<span class="nv">rtmp1</span><span class="o">=</span><span class="s1">&#39;rtmp://&#39;</span><span class="nv">$Url</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/102&#39;</span>
<span class="nv">rtmp2</span><span class="o">=</span><span class="s1">&#39;rtmp://&#39;</span><span class="nv">$Url</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/202&#39;</span>
<span class="nv">rtmp3</span><span class="o">=</span><span class="s1">&#39;rtmp://&#39;</span><span class="nv">$Url</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/302&#39;</span>
<span class="nv">rtmp4</span><span class="o">=</span><span class="s1">&#39;rtmp://&#39;</span><span class="nv">$Url</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/402&#39;</span>
<span class="nv">rtmp5</span><span class="o">=</span><span class="s1">&#39;rtmp://&#39;</span><span class="nv">$Url</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/502&#39;</span>
<span class="nv">rtmp6</span><span class="o">=</span><span class="s1">&#39;rtmp://&#39;</span><span class="nv">$Url</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/602&#39;</span>

<span class="c">#MD5 加密串</span>
<span class="nv">md5Url1</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/102-&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$pushIdentKey</span>
<span class="c">#MD5 加密</span>
<span class="nv">md5Str1</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="nv">$md5Url1</span> | md5sum | awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="c">#完整推流地址</span>
<span class="nv">finallyPushUrl1</span><span class="o">=</span><span class="nv">$rtmp1</span><span class="s1">&#39;?auth_key=&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$md5Str1</span>

<span class="nv">md5Url2</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/202-&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$pushIdentKey</span>
<span class="nv">md5Str2</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="nv">$md5Url2</span> | md5sum | awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="nv">finallyPushUrl2</span><span class="o">=</span><span class="nv">$rtmp2</span><span class="s1">&#39;?auth_key=&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$md5Str2</span>

<span class="nv">md5Url3</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/302-&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$pushIdentKey</span>
<span class="nv">md5Str3</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="nv">$md5Url3</span> | md5sum | awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="nv">finallyPushUrl3</span><span class="o">=</span><span class="nv">$rtmp3</span><span class="s1">&#39;?auth_key=&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$md5Str3</span>

<span class="nv">md5Url4</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/402-&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$pushIdentKey</span>
<span class="nv">md5Str4</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="nv">$md5Url4</span> | md5sum | awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="nv">finallyPushUrl4</span><span class="o">=</span><span class="nv">$rtmp4</span><span class="s1">&#39;?auth_key=&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$md5Str4</span>

<span class="nv">md5Url5</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/502-&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$pushIdentKey</span>
<span class="nv">md5Str5</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="nv">$md5Url5</span> | md5sum | awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="nv">finallyPushUrl5</span><span class="o">=</span><span class="nv">$rtmp5</span><span class="s1">&#39;?auth_key=&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$md5Str5</span>

<span class="nv">md5Url6</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="nv">$appName</span><span class="s1">&#39;/602-&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$pushIdentKey</span>
<span class="nv">md5Str6</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="nv">$md5Url6</span> | md5sum | awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="nv">finallyPushUrl6</span><span class="o">=</span><span class="nv">$rtmp6</span><span class="s1">&#39;?auth_key=&#39;</span><span class="nv">$timestamp</span><span class="s1">&#39;-0-0-&#39;</span><span class="nv">$md5Str6</span>

start<span class="o">(){</span>
   <span class="nb">echo</span> <span class="s2">&quot;开始推流 ............... &quot;</span>  
    <span class="k">for </span>i in <span class="k">$(</span>seq 1 <span class="nv">$cameNum</span><span class="k">)</span>  
    <span class="k">do   </span>
<span class="k">        </span><span class="nv">rtspUrl</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval echo</span> <span class="s1">&#39;$&#39;</span><span class="s2">&quot;came$i&quot;</span><span class="sb">`</span>
        <span class="nv">rtmpUrl</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval echo</span> <span class="s1">&#39;$&#39;</span><span class="s2">&quot;finallyPushUrl$i&quot;</span><span class="sb">`</span>
        <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;$rtspUrl&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>nohup ffmpeg -re -rtsp_transport tcp -i <span class="nv">$rtspUrl</span> -c:a copy -c:v libx264 -preset:v fast -tune:v zerolatency -max_delay 100 -f flv -g 5 -b 1024k <span class="nv">$rtmpUrl</span> 2&gt; /dev/null &amp;
    <span class="k">fi</span>
<span class="k">    done</span>   
<span class="o">}</span>

stop<span class="o">(){</span>
    ps -e|grep ffmpeg|awk <span class="s1">&#39;{print $1}&#39;</span>|xargs <span class="nb">kill</span> -9
<span class="o">}</span>

<span class="k">case</span> <span class="nv">$1</span> in
   start<span class="o">)</span>
      start
   ;;
   stop<span class="o">)</span>
      stop
   ;;
   restart<span class="o">)</span>
      stop
      sleep 2
      start
    ;;
   *<span class="o">)</span>
      <span class="nb">echo</span> <span class="s2">$&quot;Usage: $0 {start|stop|restart}&quot;</span>  
</pre></div>
</div>
<div id="renote">
  <HR style=" FILTER: alpha (opacity = 100, finishopacity =0 , style= 3 )" width="80%" color=#987 cb 9 SIZE=3>
  <p>如果你觉得这篇文章对你有帮助，不妨请我喝杯咖啡，鼓励我创造更多!</p>
  <img src="/Wiki/static/images/pay.jpg" width="25%">
</div>

    </div>
    <div id="footer">
        <span>
            Copyright © 2021 zhang787jun.
            Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        </span>
    </div>

    
</body>
<script>
    function changeImgurl(site_root_url) {
        var images = document.images;
        var site_root = site_root_url;
        for (i = 0, len = images.length; i < len; i++) {
            image = images[i];
            image_src = image.src;
            if (image_src.search("attach") >= 0) {
                re_image_src = image_src.slice(image_src.search("attach"));
                abs_image_src = (site_root.endsWith("/")) ? site_root + re_image_src : site_root + "/" +
                    re_image_src;
                image.src = abs_image_src;
            }
        }
    }
    var site_root_url = "/Wiki";
    changeImgurl(site_root_url);
    let isMathjaxConfig = false; // 防止重复调用Config，造成性能损耗
    const initMathjaxConfig = () => {
        if (!window.MathJax) {
            return;
        }
        window.MathJax.Hub.Config({
            showProcessingMessages: false, //关闭js加载过程信息
            messageStyle: "none", //不显示信息
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [["$", "$"], ["\\(", "\\)"]], //行内公式选择符
                displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
                skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
            },
            "HTML-CSS": {
                availableFonts: ["STIX", "TeX"], //可选字体
                showMathMenu: false //关闭右击菜单显示
            }
        });
        isMathjaxConfig = true; //
    };
    if (isMathjaxConfig === false) {
        // 如果：没有配置MathJax
        initMathjaxConfig();
    };
</script>

</html>