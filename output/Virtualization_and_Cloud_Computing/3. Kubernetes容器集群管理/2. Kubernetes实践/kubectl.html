<!DOCTYPE HTML>
<html>

<head>
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <title>kubectl 命令行 - Jun's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Wiki" />
    <meta name="description" content="A wiki website" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            }
        });
    </script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
</head>

<body>

    <div id="container">
        
<div id="header">
  <div id="post-nav"><a href="/Wiki/">Home</a>&nbsp;»&nbsp;<a href="/Wiki/#Virtualization_and_Cloud_Computing\3. Kubernetes容器集群管理\2. Kubernetes实践">Virtualization_and_Cloud_Computing\3. Kubernetes容器集群管理\2. Kubernetes实践</a>&nbsp;»&nbsp;kubectl 命令行</div>
</div>
<div class="clearfix"></div>
<div id="title">kubectl 命令行</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#1-kubectl">1. kubectl 概述</a></li>
<li><a href="#2">2. 命令表</a><ul>
<li><a href="#21">2.1. 检查集群节点，及服务健康状态</a></li>
<li><a href="#22">2.2. 查看配置</a></li>
<li><a href="#23">2.3. 资源配置</a></li>
<li><a href="#24">2.4. 启动容器</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="1-kubectl">1. kubectl 概述</h1>
<p>kubectl是一个用于操作kubernetes集群的命令行接口，通过利用kubectl的各种命令可以实现各种功能。</p>
<table>
<thead>
<tr>
<th>命令 kubectl [flags]</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>kubectl alpha</td>
<td>alpha环境上命令属性</td>
</tr>
<tr>
<td>kubectl annotate</td>
<td>更新资源上注释</td>
</tr>
<tr>
<td>kubectl api-resources</td>
<td>在服务器上打印支持的 API 资源</td>
</tr>
<tr>
<td>kubectl api-versions</td>
<td>以 “group/version” 的形式在服务器上打印支持的 API 版本</td>
</tr>
<tr>
<td>kubectl apply</td>
<td>通过文件名或标准输入将配置添加给资源</td>
</tr>
<tr>
<td>kubectl attach</td>
<td>附加到正在运行的容器</td>
</tr>
<tr>
<td>kubectl auth</td>
<td>检查授权</td>
</tr>
<tr>
<td>kubectl autoscale</td>
<td>自动扩展 Deployment, ReplicaSet 或 ReplicationController</td>
</tr>
<tr>
<td>kubectl certificate</td>
<td>修改证书资源。</td>
</tr>
<tr>
<td>kubectl cluster-info</td>
<td>展示集群信息</td>
</tr>
<tr>
<td>kubectl completion</td>
<td>为给定的 shell 输出完成代码（ bash 或 zsh）</td>
</tr>
<tr>
<td>kubectl config</td>
<td>修改 kubeconfig 配置文件</td>
</tr>
<tr>
<td>kubectl convert</td>
<td>在不同的 API 版本之间转换配置文件</td>
</tr>
<tr>
<td>kubectl cordon</td>
<td>将 node 节点标记为不可调度</td>
</tr>
<tr>
<td>kubectl cp</td>
<td>从容器复制文件和目录，也可将文件和目录复制到容器。</td>
</tr>
<tr>
<td>kubectl create</td>
<td>通过文件名或标准输入创建资源。</td>
</tr>
<tr>
<td>kubectl delete</td>
<td>通过文件名，标准输入，资源和名称或资源和标签选择器删除资源</td>
</tr>
<tr>
<td>kubectl describe</td>
<td>显示特定资源或资源组的详细信息</td>
</tr>
<tr>
<td>kubectl drain</td>
<td>为便于维护，需要提前驱逐node节点</td>
</tr>
<tr>
<td>kubectl edit</td>
<td>在服务器编辑资源</td>
</tr>
<tr>
<td>kubectl exec</td>
<td>容器内退出命令</td>
</tr>
<tr>
<td>kubectl explain</td>
<td>资源文档</td>
</tr>
<tr>
<td>kubectl expose</td>
<td>获取 replication controller, service, deployment 或 pod 资源，并作为新的 Kubernetes 服务暴露</td>
</tr>
<tr>
<td>kubectl get</td>
<td>展示一个或多个资源</td>
</tr>
<tr>
<td>kubectl label</td>
<td>升级资源标签</td>
</tr>
<tr>
<td>kubectl logs</td>
<td>为 pod 中的容器打印日志</td>
</tr>
<tr>
<td>kubectl options</td>
<td>打印所有命令继承的标识列表</td>
</tr>
<tr>
<td>kubectl patch</td>
<td>使用战略性合并补丁更新资源字段</td>
</tr>
<tr>
<td>kubectl plugin</td>
<td>运行命令行插件</td>
</tr>
<tr>
<td>kubectl port-forward</td>
<td>给 pod 开放一个或多个本地端口</td>
</tr>
<tr>
<td>kubectl proxy</td>
<td>为 Kubernetes API server 运行代理</td>
</tr>
<tr>
<td>kubectl replace</td>
<td>通过文件或标准输入替换资源</td>
</tr>
<tr>
<td>kubectl rollout</td>
<td>管理资源展示</td>
</tr>
<tr>
<td>kubectl run</td>
<td>在集群上运行指定镜像</td>
</tr>
<tr>
<td>kubectl scale</td>
<td>给 Deployment, ReplicaSet, Replication Controller 或 Job 设置新副本规模</td>
</tr>
<tr>
<td>kubectl set</td>
<td>给对象设置特定功能</td>
</tr>
<tr>
<td>kubectl taint</td>
<td>更新一个或多个 node 节点的污点信息</td>
</tr>
<tr>
<td>kubectl top</td>
<td>展示资源 (CPU/Memory/Storage) 使用信息。</td>
</tr>
<tr>
<td>kubectl uncordon</td>
<td>标记 node 节点为可调度</td>
</tr>
<tr>
<td>kubectl version</td>
<td>打印客户端和服务端版本信息</td>
</tr>
<tr>
<td>kubectl wait</td>
<td>试验: 在一个或多个资源上等待条件完成</td>
</tr>
</tbody>
</table>
<h1 id="2">2. 命令表</h1>
<div class="hlcode"><pre><span class="cp"># kubectl命令列表</span>

<span class="n">kubectl</span> <span class="n">run</span><span class="err">（创建容器镜像）</span>
<span class="n">kubectl</span> <span class="n">expose</span><span class="err">（将资源暴露为新的</span> <span class="n">Service</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">annotate</span><span class="err">（更新资源的</span><span class="n">Annotations</span><span class="err">信息）</span>
<span class="n">kubectl</span> <span class="n">autoscale</span><span class="err">（</span><span class="n">Pod</span><span class="err">水平自动伸缩）</span>
<span class="n">kubectl</span> <span class="n">convert</span><span class="err">（转换配置文件为不同的</span><span class="n">API</span><span class="err">版本）</span>

<span class="n">kubectl</span> <span class="n">create</span><span class="err">（创建一个集群资源对象</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">clusterrole</span><span class="err">（创建</span><span class="n">ClusterRole</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">clusterrolebinding</span><span class="err">（为特定的</span><span class="n">ClusterRole</span><span class="err">创建</span><span class="n">ClusterRoleBinding</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">configmap</span><span class="err">（创建</span><span class="n">configmap</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">deployment</span><span class="err">（创建</span><span class="n">deployment</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">namespace</span><span class="err">（创建</span><span class="n">namespace</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">poddisruptionbudget</span><span class="err">（创建</span><span class="n">poddisruptionbudget</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">quota</span><span class="err">（创建</span><span class="n">resourcequota</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">role</span><span class="err">（创建</span><span class="n">role</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">rolebinding</span><span class="err">（为特定</span><span class="n">Role</span><span class="err">或</span><span class="n">ClusterRole</span><span class="err">创建</span><span class="n">RoleBinding</span><span class="err">）</span>

<span class="n">kubectl</span> <span class="n">create</span> <span class="n">service</span><span class="err">（使用指定的子命令创建</span> <span class="n">Service</span><span class="err">服务）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">service</span> <span class="n">clusterip</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">service</span> <span class="n">externalname</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">service</span> <span class="n">loadbalancer</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">service</span> <span class="n">nodeport</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">serviceaccount</span>

<span class="n">kubectl</span> <span class="n">create</span> <span class="n">secret</span><span class="err">（使用指定的子命令创建</span> <span class="n">secret</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">secret</span> <span class="n">tls</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">secret</span> <span class="n">generic</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">secret</span> <span class="n">docker</span><span class="o">-</span><span class="n">registry</span>

<span class="n">kubectl</span> <span class="n">delete</span><span class="err">（删除资源对象）</span>


<span class="n">kubectl</span> <span class="n">delete</span> <span class="n">namespace</span> <span class="n">NAMESPACENAME</span> <span class="o">--</span><span class="n">force</span> <span class="o">--</span><span class="n">grace</span><span class="o">-</span><span class="n">period</span><span class="o">=</span><span class="mi">0</span>


<span class="n">kubectl</span> <span class="n">edit</span><span class="err">（编辑服务器上定义的资源对象）</span>
<span class="n">kubectl</span> <span class="n">get</span><span class="err">（获取资源信息）</span>
<span class="n">kubectl</span> <span class="n">label</span><span class="err">（更新资源对象的</span><span class="n">label</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">patch</span><span class="err">（使用</span><span class="n">patch</span><span class="err">更新资源对象字段）</span>
<span class="n">kubectl</span> <span class="n">replace</span><span class="err">（替换资源对象）</span>
<span class="n">kubectl</span> <span class="n">rolling</span><span class="o">-</span><span class="n">update</span><span class="err">（使用</span><span class="n">RC</span><span class="err">进行滚动更新）</span>
<span class="n">kubectl</span> <span class="n">scale</span><span class="err">（扩缩</span><span class="n">Pod</span><span class="err">数量）</span>

<span class="n">kubectl</span> <span class="n">rollout</span><span class="err">（对资源对象进行管理）</span>
<span class="n">kubectl</span> <span class="n">rollout</span> <span class="n">history</span><span class="err">（查看历史版本）</span>
<span class="n">kubectl</span> <span class="n">rollout</span> <span class="n">pause</span><span class="err">（标记资源对象为暂停状态）</span>
<span class="n">kubectl</span> <span class="n">rollout</span> <span class="n">resume</span><span class="err">（恢复已暂停资源）</span>
<span class="n">kubectl</span> <span class="n">rollout</span> <span class="n">status</span><span class="err">（查看资源状态）</span>
<span class="n">kubectl</span> <span class="n">rollout</span> <span class="n">undo</span><span class="err">（回滚版本）</span>

<span class="n">kubectl</span> <span class="n">set</span><span class="err">（配置应用资源）</span>
<span class="n">kubectl</span> <span class="n">set</span> <span class="n">resources</span><span class="err">（指定</span><span class="n">Pod</span><span class="err">的计算资源需求）</span>
<span class="n">kubectl</span> <span class="n">set</span> <span class="n">selector</span><span class="err">（设置资源对象</span><span class="n">selector</span><span class="err">）</span>
<span class="n">kubectl</span> <span class="n">set</span> <span class="n">image</span><span class="err">（更新已有资源对象中的容器镜像）</span>
<span class="n">kubectl</span> <span class="n">set</span> <span class="n">subject</span><span class="err">（更新</span><span class="n">RoleBinding</span> <span class="o">/</span> <span class="n">ClusterRoleBinding</span><span class="err">中</span><span class="n">User</span><span class="err">、</span><span class="n">Group</span> <span class="err">或</span> <span class="n">ServiceAccount</span><span class="err">）</span>

<span class="cp"># 查看集群信息</span>
<span class="n">kubectl</span> <span class="n">cluster</span><span class="o">-</span><span class="n">info</span>
</pre></div>


<h2 id="21">2.1. 检查集群节点，及服务健康状态</h2>
<div class="hlcode"><pre><span class="cp"># 检查集群节点</span>
<span class="n">kubectl</span> <span class="n">get</span> <span class="n">node</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">NAME</span>           <span class="n">STATUS</span>    <span class="n">AGE</span>
<span class="mf">192.168.10.8</span>   <span class="n">Ready</span>     <span class="mi">22</span><span class="n">h</span>
<span class="mf">192.168.10.9</span>   <span class="n">Ready</span>     <span class="mi">21</span><span class="n">h</span>

<span class="cp"># 各组件服务健康状态</span>
<span class="n">kubectl</span> <span class="n">get</span> <span class="n">cs</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">NAME</span>                 <span class="n">STATUS</span>    <span class="n">MESSAGE</span>              <span class="n">ERROR</span>
<span class="n">scheduler</span>            <span class="n">Healthy</span>   <span class="n">ok</span>                   
<span class="n">controller</span><span class="o">-</span><span class="n">manager</span>   <span class="n">Healthy</span>   <span class="n">ok</span>                   
<span class="n">etcd</span><span class="o">-</span><span class="mi">0</span>               <span class="n">Healthy</span>   <span class="p">{</span><span class="s">&quot;health&quot;</span><span class="o">:</span> <span class="s">&quot;true&quot;</span><span class="p">}</span> 
</pre></div>


<h2 id="22">2.2. 查看配置</h2>
<div class="hlcode"><pre><span class="n">kubectl</span> <span class="n">config</span> <span class="n">view</span>
</pre></div>


<h2 id="23">2.3. 资源配置</h2>
<p>通过文件名或控制台输入，对资源进行配置。</p>
<div class="hlcode"><pre><span class="cp"># 通过文件名或控制台输入，对资源进行配置。</span>
<span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">FILENAME</span>
<span class="cp"># -f file 接受 json /yml格式的配置文件</span>
</pre></div>


<div class="hlcode"><pre>  <span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="o">--</span><span class="n">filename</span><span class="o">=</span><span class="p">[]</span><span class="o">:</span> <span class="err">包含配置信息的文件名，目录名或者</span><span class="n">URL</span><span class="err">。</span>
  <span class="o">-</span><span class="n">o</span><span class="p">,</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">:</span> <span class="err">输出格式，使用“</span><span class="o">-</span><span class="n">o</span> <span class="n">name</span><span class="err">”来输出简短格式（资源类型</span><span class="o">/</span><span class="err">资源名）。</span>
      <span class="o">--</span><span class="n">schema</span><span class="o">-</span><span class="n">cache</span><span class="o">-</span><span class="n">dir</span><span class="o">=</span><span class="s">&quot;/tmp/kubectl.schema&quot;</span><span class="o">:</span> <span class="err">如果不为空，将</span><span class="n">API</span> <span class="n">schema</span><span class="err">缓存为指定文件，默认缓存到“</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">kubectl</span><span class="p">.</span><span class="n">schema</span><span class="err">”。</span>
      <span class="o">--</span><span class="n">validate</span><span class="p">[</span><span class="o">=</span><span class="nb">true</span><span class="p">]</span><span class="o">:</span> <span class="err">如果为</span><span class="nb">true</span><span class="err">，在发送到服务端前先使用</span><span class="n">schema</span><span class="err">来验证输入。</span>
</pre></div>


<p>应用配置文件 <code>app1_config.yml</code> 主要有4部分组成 <br />
1. apiVersion<br />
2. kind<br />
3. metadata<br />
4. spec</p>
<div class="hlcode"><pre><span class="cp"># 1. api版本信息</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="cp"># 2. 表示资源类型</span>
<span class="nl">kind:</span> <span class="n">Namespace</span>
<span class="cp"># 3. 应用元信息</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">k8s</span><span class="o">-</span><span class="n">example</span> <span class="err">#</span> <span class="err">名字</span>
  <span class="nl">labels:</span>
    <span class="nl">app:</span> <span class="n">k8s</span><span class="o">-</span><span class="n">example</span>
    <span class="nl">name:</span> <span class="n">k8s</span><span class="o">-</span><span class="n">example</span>
    <span class="nl">project:</span> <span class="n">k8s</span><span class="o">-</span><span class="n">example</span>
<span class="cp"># 4. 资源规范字段</span>
<span class="nl">spec:</span>
  <span class="nl">ports:</span>
  <span class="o">-</span> <span class="n">port</span><span class="o">:</span> <span class="mi">6379</span>
    <span class="nl">targetPort:</span> <span class="mi">6379</span>
  <span class="nl">selector:</span>
    <span class="nl">app:</span> <span class="n">redis</span>
</pre></div>


<h2 id="24">2.4. 启动容器</h2>
<div class="hlcode"><pre><span class="n">kubectl</span> <span class="n">run</span> <span class="n">NAME</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">image</span> <span class="p">[</span><span class="o">--</span><span class="n">env</span><span class="o">=</span><span class="s">&quot;key=value&quot;</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">replicas</span><span class="o">=</span><span class="n">replicas</span><span class="p">]</span>
</pre></div>


<ul>
<li><code>replicas</code>：副本数量</li>
<li><code>port</code>：释放出的端口号</li>
</ul>
</div>
<div id="renote">
  <HR style=" FILTER: alpha (opacity = 100, finishopacity =0 , style= 3 )" width="80%" color=#987 cb 9 SIZE=3>
  <p>如果你觉得这篇文章对你有帮助，不妨请我喝杯咖啡，鼓励我创造更多!</p>
  <img src="/Wiki/static/images/pay.jpg" width="25%">
</div>

    </div>
    <div id="footer">
        <span>
            Copyright © 2020 zhang787jun.
            Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        </span>
    </div>

    
</body>
<script>
    function changeImgurl(site_root_url) {
        var images = document.images;
        var site_root = site_root_url;
        for (i = 0, len = images.length; i < len; i++) {
            image = images[i];
            image_src = image.src;
            if (image_src.search("attach") >= 0) {
                re_image_src = image_src.slice(image_src.search("attach"));
                abs_image_src = (site_root.endsWith("/")) ? site_root + re_image_src : site_root + "/" +
                    re_image_src;
                image.src = abs_image_src;
            }
        }
    }
    var site_root_url = "/Wiki";
    changeImgurl(site_root_url);
    let isMathjaxConfig = false; // 防止重复调用Config，造成性能损耗
    const initMathjaxConfig = () => {
        if (!window.MathJax) {
            return;
        }
        window.MathJax.Hub.Config({
            showProcessingMessages: false, //关闭js加载过程信息
            messageStyle: "none", //不显示信息
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [["$", "$"], ["\\(", "\\)"]], //行内公式选择符
                displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
                skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
            },
            "HTML-CSS": {
                availableFonts: ["STIX", "TeX"], //可选字体
                showMathMenu: false //关闭右击菜单显示
            }
        });
        isMathjaxConfig = true; //
    };
    if (isMathjaxConfig === false) {
        // 如果：没有配置MathJax
        initMathjaxConfig();
    };
</script>

</html>