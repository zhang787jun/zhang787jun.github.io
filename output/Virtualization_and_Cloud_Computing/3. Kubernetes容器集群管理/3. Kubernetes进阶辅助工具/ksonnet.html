<!DOCTYPE HTML>
<html>

<head>
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <title>ksonnet--用于创建、分享、发布Kubernetes应用配置文件的框架 - Jun's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Wiki" />
    <meta name="description" content="A wiki website" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            }
        });
    </script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
</head>

<body>

    <div id="container">
        
<div id="header">
  <div id="post-nav"><a href="/Wiki/">Home</a>&nbsp;»&nbsp;<a href="/Wiki/#Virtualization_and_Cloud_Computing\3. Kubernetes容器集群管理\3. Kubernetes进阶辅助工具">Virtualization_and_Cloud_Computing\3. Kubernetes容器集群管理\3. Kubernetes进阶辅助工具</a>&nbsp;»&nbsp;ksonnet--用于创建、分享、发布Kubernetes应用配置文件的框架</div>
</div>
<div class="clearfix"></div>
<div id="title">ksonnet--用于创建、分享、发布Kubernetes应用配置文件的框架</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#1">1. 概述</a><ul>
<li><a href="#11-2">1.1. 基本概念 2</a><ul>
<li><a href="#111-ksonnet-application">1.1.1. ksonnet application 应用</a></li>
<li><a href="#112-ksonnet-component">1.1.2. ksonnet component组件</a></li>
<li><a href="#113-ksonnet-environments">1.1.3. ksonnet environments 环境</a></li>
<li><a href="#114-prototype">1.1.4. prototype 原型</a></li>
<li><a href="#115-package">1.1.5. Package 资源包</a></li>
<li><a href="#116-registry">1.1.6. Registry 仓库</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2">2. 安装</a><ul>
<li><a href="#21">2.1. 二进制文件</a></li>
<li><a href="#22">2.2. 源码安装</a></li>
<li><a href="#23">2.3. 国内镜像</a></li>
</ul>
</li>
<li><a href="#3">3. 基础命令</a><ul>
<li><a href="#31-ksonnet-app">3.1. ksonnet app 的初始化创建</a></li>
<li><a href="#32-component-manifest">3.2. 为应用生成组件(配置文件)component manifest</a></li>
<li><a href="#33">3.3. 将配置文件的应用在集群中</a></li>
<li><a href="#34">3.4. 将资源从集群中删除</a></li>
<li><a href="#35">3.5. 组件的管理</a><ul>
<li><a href="#351-prototype">3.5.1. prototype</a></li>
<li><a href="#352-packages">3.5.2. packages</a></li>
<li><a href="#353">3.5.3. 仓库</a></li>
<li><a href="#354">3.5.4. 组件</a></li>
</ul>
</li>
<li><a href="#36-environments">3.6. 管理Environments</a></li>
<li><a href="#37">3.7. 其他</a></li>
<li><a href="#38-github">3.8. Github限速错误</a></li>
</ul>
</li>
<li><a href="#4">4. 参考资料</a></li>
</ul>
</div>
<h1 id="1">1. 概述</h1>
<p>ksonnet is a framework for writing, sharing, and deploying Kubernetes application manifests(配置文件). With its CLI, you can generate a complete application from scratch in only a few commands, or manage a complex system at scale.</p>
<p>ksonnet 是一个基于jsonnet的快速简化kubernetes yaml 配置的工具，可以实现配置的复用.</p>
<h2 id="11-2">1.1. 基本概念 <sup id="fnref:3"><a class="footnote-ref" href="#fn:3" rel="footnote">2</a></sup></h2>
<h3 id="111-ksonnet-application">1.1.1. ksonnet application 应用</h3>
<p>一个ksonnet应用就是一个结构化的Kubernetes配置文件夹<br />
A ksonnet application represents a well-structured directory of Kubernetes manifests.</p>
<h3 id="112-ksonnet-component">1.1.2. ksonnet component组件</h3>
<p>一个应用可以分成多个组件,一个组件可以是一个Kubernetes资源 或者多个资源</p>
<h3 id="113-ksonnet-environments">1.1.3. ksonnet environments 环境</h3>
<p>4个关键元素决定一个环境的配置.</p>
<table>
<thead>
<tr>
<th>What</th>
<th>Example</th>
<th>Description</th>
<th>How is this tracked?</th>
</tr>
</thead>
<tbody>
<tr>
<td>(1) <em>Name</em></td>
<td>dev</td>
<td>字符串,在ksonnet app 中必须是unique的</td>
<td>A directory under <code>environments/</code> (e.g. <code>environments/dev/</code>). <br><br><strong>A name with slashes results in a hierarchical file structure</strong>. For example, <code>us-west/staging</code> creates <code>environments/us-west/staging/</code>.</td>
</tr>
<tr>
<td>(2) <em>Server</em></td>
<td>https://cluster-name-with-hash.us-west-2.elb.amazonaws.com</td>
<td>The address and port of a Kubernetes API server. In other words, identifies a unique cluster.</td>
<td>Inside <code>app.yaml</code></td>
</tr>
<tr>
<td>(3) <em>Namespace</em></td>
<td>dev</td>
<td>Specifically, a <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Kubernetes namespace</a>.</td>
<td>Inside <code>app.yaml</code></td>
</tr>
<tr>
<td>(4) <em>Kubernetes API version</em></td>
<td>version:v1.7.1</td>
<td>The version of your cluster's Kubernetes API server, defaults to v1.8.0.</td>
<td>Used to generate appropriate files in <code>lib/ksonnet-lib/</code> based on the specified version of the Kubernetes OpenAPI spec</td>
</tr>
</tbody>
</table>
<h3 id="114-prototype">1.1.4. prototype 原型</h3>
<p>原型可以想象为类与<code>Class</code>相似,Component 是 prototype 的实例.<br />
prototype 本身就是提前写好但未完成的配置文件,使用prototype可以避免对重复文件的粘贴复制。</p>
<p>仓库:包的集合<br />
包:原型的集合</p>
<div class="hlcode"><pre><span class="n">Component</span><span class="o">=</span><span class="n">prototype</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">pakages</span><span class="o">=</span><span class="n">Components</span><span class="o">=</span><span class="p">[</span><span class="n">Component_1</span><span class="p">,</span><span class="n">Components_2</span><span class="p">,...,]</span>
</pre></div>


<p><img alt="" src="../../../../attach/images/2019-12-21-12-15-04.png" /></p>
<h3 id="115-package">1.1.5. Package 资源包</h3>
<p>包是一系列相关的原型prototypes的集合<br />
A package contains:<br />
1. A set of related prototypes (e.g. redis-persistent, redis-stateless)<br />
2. Associated helper libraries that define the prototype parts (e.g. redis.libsonnet)</p>
<p>典型的资源包目录文件夹</p>
<div class="hlcode"><pre><span class="p">.</span>
<span class="err">├──</span> <span class="n">README</span><span class="p">.</span><span class="n">md</span>                      <span class="c1">// Human-readable description of the package</span>
<span class="err">├──</span> <span class="n">parts</span><span class="p">.</span><span class="n">yaml</span>                     <span class="c1">// Provides metadata about the package</span>
<span class="err">├──</span> <span class="n">prototypes</span>                     <span class="c1">// Can be imported and used to generate components</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">redis</span><span class="o">-</span><span class="n">all</span><span class="o">-</span><span class="n">features</span><span class="p">.</span><span class="n">jsonnet</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">redis</span><span class="o">-</span><span class="n">persistent</span><span class="p">.</span><span class="n">jsonnet</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="n">redis</span><span class="o">-</span><span class="n">stateless</span><span class="p">.</span><span class="n">jsonnet</span>
<span class="err">└──</span> <span class="n">redis</span><span class="p">.</span><span class="n">libsonnet</span>                <span class="c1">// Helper library, includes prototype parts</span>
</pre></div>


<p><code>parts.yaml</code> 里面是关于包的源数据 。metadata is used to populate the output of the ks prototype describe command. </p>
<h3 id="116-registry">1.1.6. Registry 仓库</h3>
<p>Registries 仓库通过在<strong>根目录</strong>下的 <code>registry.yaml</code>文件确定该仓库的packages数量。<br />
一个典型的仓库文件夹目录结构如下：</p>
<div class="hlcode"><pre><span class="p">.</span>
<span class="err">├──</span> <span class="n">nginx</span>                               <span class="c1">// nginx package</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">README</span><span class="p">.</span><span class="n">md</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">nginx</span><span class="p">.</span><span class="n">libsonnet</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">parts</span><span class="p">.</span><span class="n">yaml</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="n">prototypes</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="n">nginx</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">block</span><span class="p">.</span><span class="n">jsonnet</span>
<span class="err">│</span>       <span class="p">...</span>
<span class="err">├──</span> <span class="n">redis</span>                               <span class="c1">// redis package</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">README</span><span class="p">.</span><span class="n">md</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">parts</span><span class="p">.</span><span class="n">yaml</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">prototypes</span>
<span class="err">│</span>   <span class="err">│</span>   <span class="err">├──</span> <span class="n">redis</span><span class="o">-</span><span class="n">all</span><span class="o">-</span><span class="n">features</span><span class="p">.</span><span class="n">jsonnet</span>
<span class="err">│</span>   <span class="err">│</span>   <span class="p">...</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="n">redis</span><span class="p">.</span><span class="n">libsonnet</span>
<span class="err">└──</span> <span class="n">registry</span><span class="p">.</span><span class="n">yaml</span>                       <span class="c1">// Lists all </span>
</pre></div>


<p>用户可以使用<strong>默认</strong>或<strong>自定义</strong>的仓库：<br />
1. 默认仓库<br />
   默认仓库为 <code>Incubator（孵化器）Registry</code><br />
   * 默认情况下从<code>/ksonnet/parts/incubator</code> 仓库下载（Github 地址：https://github.com/ksonnet/parts/tree/master/incubator）</p>
<ol>
<li>自定义仓库<br />
   有3种方式：</li>
<li><strong>Github</strong> - a Github URI </li>
<li><strong>Filesystem</strong> 本地文件系统 - a valid path to a local registry</li>
<li><strong>Helm</strong> - a URI to a Helm repository</li>
</ol>
<h1 id="2">2. 安装</h1>
<h2 id="21">2.1. 二进制文件</h2>
<p>https://github.com/ksonnet/ksonnet/releases/tag/v0.13.1</p>
<h2 id="22">2.2. 源码安装</h2>
<div class="hlcode"><pre><span class="cp"># Clone the ksonnet repo into your GOPATH</span>
<span class="n">go</span> <span class="n">get</span> <span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ksonnet</span><span class="o">/</span><span class="n">ksonnet</span>

<span class="cp"># Build and install binary under shortname `ks` into $GOPATH/bin</span>
<span class="n">cd</span> <span class="err">$</span><span class="n">GOPATH</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ksonnet</span><span class="o">/</span><span class="n">ksonnet</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>


<h2 id="23">2.3. 国内镜像</h2>
<div class="hlcode"><pre><span class="n">curl</span> <span class="o">-</span><span class="n">o</span> <span class="n">ks_0</span><span class="mf">.9.2</span><span class="n">_linux_amd64</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span> <span class="n">http</span><span class="o">:</span><span class="c1">//kubeflow.oss-cn-beijing.aliyuncs.com/ks_0.9.2_linux_amd64.tar.gz</span>

<span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">ks_0</span><span class="mf">.9.2</span><span class="n">_linux_amd64</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="n">cp</span> <span class="n">ks_0</span><span class="mf">.9.2</span><span class="n">_linux_amd64</span><span class="o">/</span><span class="n">ks</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span>
<span class="cp">#检查是否安装成功</span>
<span class="n">ks</span> <span class="n">version</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>


<h1 id="3">3. 基础命令</h1>
<p>使用 ks 命令行生成Kubernetes资源本地（在 <code>jsonnet</code>）的配置文件</p>
<div class="hlcode"><pre><span class="cp"># 帮助文件</span>
<span class="n">ks</span> <span class="o">--</span><span class="n">help</span>
</pre></div>


<h2 id="31-ksonnet-app">3.1. ksonnet app 的初始化创建</h2>
<p>使用<code>ks init</code>命令<sup id="fnref:2"><a class="footnote-ref" href="#fn:2" rel="footnote">1</a></sup>创建ksonnet 应用,输出的结果就是生成结构化的k8s应用配置文件.</p>
<div class="hlcode"><pre><span class="cp"># 创建名为&lt;app-name&gt; 的 文件夹，并初始化ksonnet应用</span>
<span class="n">ks</span> <span class="n">init</span> <span class="o">&lt;</span><span class="n">app</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">flags</span><span class="p">]</span>
</pre></div>


<div class="hlcode"><pre><span class="err">#</span><span class="nx">设置context为</span> <span class="s1">&#39;dev&#39;</span><span class="nx">.</span>
<span class="nx">ks</span> <span class="nb">init</span> <span class="nx">app</span><span class="na">-name</span> <span class="o">--</span><span class="n">context</span><span class="o">=&lt;</span><span class="nx">dev</span><span class="o">&gt;</span>

<span class="err">#</span> <span class="nx">设置context为</span> <span class="s1">&#39;dev&#39;</span><span class="p">,</span><span class="nx">namespace</span> <span class="nx">为</span><span class="s2">&quot;dc-west&quot;</span>
<span class="nx">ks</span> <span class="nb">init</span> <span class="nx">app</span><span class="na">-name</span> <span class="o">--</span><span class="n">context</span><span class="o">=</span><span class="nx">dev</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=</span><span class="nx">dc</span><span class="na">-west</span>

<span class="err">#</span> <span class="nb">Initialize</span> <span class="nx">a</span> <span class="nx">ksonnet</span> <span class="nx">application</span><span class="p">,</span> <span class="nx">using</span> <span class="nx">v1.7.1</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Kubernetes</span> <span class="nx">OpenAPI</span> <span class="nx">spec</span>
<span class="err">#</span> <span class="k">to</span> <span class="nx">generate</span> <span class="s1">&#39;ksonnet-lib&#39;</span><span class="nx">.</span>
<span class="nx">ks</span> <span class="nb">init</span> <span class="nx">app</span><span class="na">-name</span> <span class="o">--</span><span class="nx">api</span><span class="na">-spec</span><span class="o">=</span><span class="nb">version</span><span class="p">:</span><span class="nx">v1.7.1</span>

<span class="err">#</span> <span class="nb">Initialize</span> <span class="nx">a</span> <span class="nx">ksonnet</span> <span class="nx">application</span><span class="p">,</span> <span class="nx">using</span> <span class="nx">the</span> <span class="nx">OpenAPI</span> <span class="nx">spec</span> <span class="nx">generated</span> <span class="k">by</span> <span class="nx">a</span>
<span class="err">#</span> <span class="nx">specific</span> <span class="nx">build</span> <span class="nx">of</span> <span class="nx">Kubernetes</span> <span class="k">to</span> <span class="nx">generate</span> <span class="s1">&#39;ksonnet-lib&#39;</span><span class="nx">.</span>
<span class="nx">ks</span> <span class="nb">init</span> <span class="nx">app</span><span class="na">-name</span> <span class="o">--</span><span class="nx">api</span><span class="na">-spec</span><span class="o">=</span><span class="nb">file</span><span class="p">:</span><span class="nx">swagger.json</span>

<span class="err">#</span> <span class="nx">设置输出应用的文件夹为</span><span class="s1">&#39;custom-location&#39;</span>
<span class="nx">ks</span> <span class="nb">init</span> <span class="nx">app</span><span class="na">-name</span> <span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="nb">custom</span><span class="na">-location</span>
</pre></div>


<p>生成目录结构 </p>
<div class="hlcode"><pre><span class="p">.</span>
<span class="err">├──</span> <span class="n">app</span><span class="p">.</span><span class="n">yaml</span>            <span class="err">#</span> <span class="err">应用配置信息</span><span class="p">(</span><span class="n">name</span> <span class="n">version</span><span class="p">)</span>
<span class="err">├──</span> <span class="n">components</span>          <span class="err">#</span> <span class="n">k8s</span><span class="err">对象的配置信息</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="n">params</span><span class="p">.</span><span class="n">libsonnet</span>
<span class="err">├──</span> <span class="n">environments</span>        <span class="err">#</span> <span class="err">应用环境</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">base</span><span class="p">.</span><span class="n">libsonnet</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="k">default</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="n">globals</span><span class="p">.</span><span class="n">libsonnet</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="n">main</span><span class="p">.</span><span class="n">jsonnet</span>
<span class="err">│</span>       <span class="err">└──</span> <span class="n">params</span><span class="p">.</span><span class="n">libsonnet</span>
<span class="err">├──</span> <span class="p">.</span><span class="n">gitignore</span>
<span class="err">├──</span> <span class="p">.</span><span class="n">ksonnet</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="n">registries</span>
<span class="err">├──</span> <span class="n">lib</span>                      <span class="err">#</span> <span class="err">用户写入的</span><span class="p">.</span><span class="n">libsonnet</span><span class="err">文件</span> 
<span class="err">└──</span> <span class="n">vendor</span>                   <span class="err">#</span> <span class="err">定义性质的库</span>
</pre></div>


<h2 id="32-component-manifest">3.2. 为应用生成组件(配置文件)component manifest</h2>
<p>Use the specified prototype to generate a component manifest by <code>ks generate</code>.</p>
<p>使用<code>ks generate</code>可以将您的空app变成一个拥有多个组件/配置文件的用于。该命令通过指定原型文件生成组件的配置文件。</p>
<div class="hlcode"><pre><span class="n">cd</span> <span class="o">&lt;</span><span class="n">project</span><span class="o">-</span><span class="n">dir</span><span class="o">&gt;</span>
<span class="n">ks</span> <span class="n">generate</span> <span class="o">&lt;</span><span class="n">prototype</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">component</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">type</span><span class="p">]</span> <span class="p">[</span><span class="n">parameter</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span> <span class="p">[</span><span class="n">flags</span><span class="p">]</span>


<span class="cp"># 查看发生了什么变化</span>
<span class="n">tree</span> <span class="o">-</span><span class="n">l</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&lt;</span><span class="n">project</span><span class="o">-</span><span class="n">dir</span><span class="o">&gt;</span>
<span class="err">├──</span> <span class="n">components</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="o">&lt;</span><span class="n">component</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">.</span><span class="n">jsonnet</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="n">params</span><span class="p">.</span><span class="n">libsonnet</span>
</pre></div>


<h2 id="33">3.3. 将配置文件的应用在集群中</h2>
<p><code>ks apply</code> — Apply local Kubernetes manifests (components) to remote clusters</p>
<div class="hlcode"><pre><span class="n">ks</span> <span class="n">apply</span> <span class="o">&lt;</span><span class="n">env</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">component</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span><span class="p">]</span> <span class="p">[</span><span class="n">flags</span><span class="p">]</span>

<span class="cp"># 在&lt;env-name&gt; 环境里面生成（或更新）所有组件资源（定义在~/components下的组件）</span>
<span class="n">ks</span> <span class="n">apply</span> <span class="o">&lt;</span><span class="n">env</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>

<span class="cp">#</span>
<span class="n">ks</span> <span class="n">apply</span> <span class="n">dev</span> <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span>

<span class="cp"># 指定组件</span>
<span class="n">ks</span> <span class="n">apply</span> <span class="n">dev</span> <span class="o">-</span><span class="n">c</span> <span class="n">guestbook</span><span class="o">-</span><span class="n">ui</span>

<span class="cp"># Create or update multiple components in a ksonnet application (e.g. &#39;guestbook-ui&#39;</span>
<span class="cp"># and &#39;nginx-depl&#39;) for the &#39;dev&#39; environment. Does not create resources that are</span>
<span class="cp"># not already present on the cluster.</span>
<span class="cp">#</span>
<span class="cp"># This essentially deploys &#39;components/guestbook-ui.jsonnet&#39; and</span>
<span class="cp"># &#39;components/nginx-depl.jsonnet&#39;.</span>
<span class="n">ks</span> <span class="n">apply</span> <span class="n">dev</span> <span class="o">-</span><span class="n">c</span> <span class="n">guestbook</span><span class="o">-</span><span class="n">ui</span> <span class="o">-</span><span class="n">c</span> <span class="n">nginx</span><span class="o">-</span><span class="n">depl</span> <span class="o">--</span><span class="n">create</span> <span class="nb">false</span>
</pre></div>


<h2 id="34">3.4. 将资源从集群中删除</h2>
<ul>
<li>Delete resources running on a cluster</li>
<li><code>ks delete</code></li>
</ul>
<h2 id="35">3.5. 组件的管理</h2>
<h3 id="351-prototype">3.5.1. prototype</h3>
<div class="hlcode"><pre><span class="n">ks</span> <span class="n">prototype</span> <span class="n">list</span>

<span class="n">ks</span> <span class="n">prototype</span> <span class="n">search</span>

<span class="n">ks</span> <span class="n">prototype</span> <span class="n">describe</span>

<span class="n">ks</span> <span class="n">prototype</span> <span class="n">preview</span>

<span class="n">ks</span> <span class="n">prototype</span> <span class="n">use</span>
</pre></div>


<h3 id="352-packages">3.5.2. packages</h3>
<div class="hlcode"><pre><span class="err">#</span> <span class="nx">查看所有的包packages</span>
<span class="nx">ks</span> <span class="nx">pkg</span> <span class="nb">list</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="nx">REGISTRY</span>  <span class="nb">NAME</span>      <span class="nb">VERSION</span>                                  <span class="nx">INSTALLED</span> <span class="nx">ENVIRONMENTS</span>
<span class="o">========</span>  <span class="o">====</span>      <span class="o">=======</span>                                  <span class="o">=========</span> <span class="o">============</span>
<span class="nx">incubator</span> <span class="nx">apache</span>    <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">efk</span>       <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">mariadb</span>   <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">memcached</span> <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">mongodb</span>   <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">mysql</span>     <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">nginx</span>     <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">node</span>      <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">postgres</span>  <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">redis</span>     <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>
<span class="nx">incubator</span> <span class="nx">tomcat</span>    <span class="mi">2</span><span class="nx">a6bd08597dde82a3d7eb7084585b3383ba6efe0</span>

<span class="err">#</span><span class="nx">描述包</span>
<span class="nx">ks</span> <span class="nx">pkg</span> <span class="nb">describe</span> <span class="o">&lt;</span><span class="nx">registry</span><span class="o">&gt;/&lt;</span><span class="nx">package</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="nb">LIBRARY</span> <span class="nb">NAME</span><span class="p">:</span>
<span class="nx">incubator</span><span class="p">/</span><span class="nx">mysql</span>

<span class="nb">DESCRIPTION</span><span class="p">:</span>
<span class="nx">MySQL</span> <span class="nx">is</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">most</span> <span class="nx">popular</span> <span class="nx">database</span> <span class="n">servers</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">world.</span> <span class="nx">Notable</span> <span class="nx">users</span> <span class="nb">include</span> <span class="nx">Wikipedia</span><span class="p">,</span> <span class="nx">Facebook</span> <span class="ow">and</span> <span class="nx">Google.</span>

<span class="err">#</span> <span class="nx">为当前</span> <span class="nx">ksonnet</span> <span class="nx">app</span> <span class="nx">添加</span>
<span class="nx">ks</span> <span class="nx">pkg</span> <span class="nb">install</span> <span class="o">&lt;</span><span class="nx">registry</span><span class="o">&gt;/&lt;</span><span class="nx">package</span><span class="o">&gt;</span><span class="p">@</span><span class="o">&lt;</span><span class="nb">version</span><span class="o">&gt;</span> <span class="err">[</span><span class="nx">flags</span><span class="cp">]</span>
&gt;&gt;&gt;
</pre></div>


<h3 id="353">3.5.3. 仓库</h3>
<p>Manage registries for current project by <code>ks registry</code></p>
<div class="hlcode"><pre><span class="cp"># 1. 查看仓库</span>
<span class="n">ks</span> <span class="n">registry</span> <span class="n">list</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">NAME</span>      <span class="n">OVERRIDE</span> <span class="n">PROTOCOL</span> <span class="n">URI</span>
<span class="o">====</span>      <span class="o">========</span> <span class="o">========</span> <span class="o">===</span>
<span class="n">incubator</span>          <span class="n">github</span>   <span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ksonnet</span><span class="o">/</span><span class="n">parts</span><span class="o">/</span><span class="n">tree</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">incubator</span>

<span class="cp"># 描述仓库</span>
<span class="n">ks</span> <span class="n">registry</span> <span class="n">describe</span> <span class="o">&lt;</span><span class="n">registry</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">flags</span><span class="p">]</span>

<span class="cp"># 添加仓库</span>
<span class="n">ks</span> <span class="n">registry</span> <span class="n">add</span> <span class="o">&lt;</span><span class="n">registry</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">registry</span><span class="o">-</span><span class="n">uri</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">flags</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">~/</span><span class="n">app</span><span class="o">/</span><span class="p">.</span><span class="n">ksonnet</span><span class="o">/</span>
<span class="err">└──</span> <span class="n">registries</span>
    <span class="err">├──</span> <span class="n">incubator</span>
    <span class="err">│</span>   <span class="err">└──</span> <span class="n">registry</span><span class="p">.</span><span class="n">yaml</span>
    <span class="err">└──</span> <span class="o">&lt;</span><span class="n">new</span><span class="o">-</span><span class="n">registry</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="err">#</span> <span class="err">新仓库</span>
        <span class="err">└──</span> <span class="n">registry</span><span class="p">.</span><span class="n">yaml</span>

<span class="cp"># 本质是在.ksonnet文件夹下创建一个新的文件夹&lt;registry-name&gt; ，把目标仓库的registry.yaml 复制过来</span>
</pre></div>


<p>添加不同类型的仓库</p>
<div class="hlcode"><pre><span class="cp"># Add a registry with the name &#39;databases&#39; at the uri &#39;github.com/example&#39;</span>
<span class="n">ks</span> <span class="n">registry</span> <span class="n">add</span> <span class="n">databases</span> <span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">example</span>

<span class="cp"># Add a registry with the name &#39;databases&#39; at the uri</span>
<span class="cp"># &#39;github.com/org/example/tree/0.0.1/registry&#39; (0.0.1 is the branch name)</span>
<span class="n">ks</span> <span class="n">registry</span> <span class="n">add</span> <span class="n">databases</span> <span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">tree</span><span class="o">/</span><span class="mf">0.0.1</span><span class="o">/</span><span class="n">registry</span>

<span class="cp"># Add a registry with a Helm Charts Repository uri</span>
<span class="n">ks</span> <span class="n">registry</span> <span class="n">add</span> <span class="n">helm</span><span class="o">-</span><span class="n">stable</span> <span class="n">https</span><span class="o">:</span><span class="c1">//kubernetes-charts.storage.googleapis.com</span>
</pre></div>


<h3 id="354">3.5.4. 组件</h3>
<div class="hlcode"><pre><span class="n">ks</span> <span class="n">component</span> <span class="n">list</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">COMPONENT</span> <span class="n">TYPE</span> <span class="n">APIVERSION</span> <span class="n">KIND</span> <span class="n">NAME</span>
<span class="o">=========</span> <span class="o">====</span> <span class="o">==========</span> <span class="o">====</span> <span class="o">====</span>


<span class="n">ks</span> <span class="n">component</span> <span class="n">rm</span>
</pre></div>


<h2 id="36-environments">3.6. 管理Environments</h2>
<div class="hlcode"><pre><span class="cp"># 进入到应用文件夹后 </span>
<span class="cp"># 查看所有环境</span>
<span class="n">ks</span> <span class="n">env</span> <span class="n">list</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">NAME</span> <span class="n">OVERRIDE</span> <span class="n">KUBERNETES</span><span class="o">-</span><span class="n">VERSION</span> <span class="n">NAMESPACE</span> <span class="n">SERVER</span>
<span class="o">====</span> <span class="o">========</span> <span class="o">==================</span> <span class="o">=========</span> <span class="o">======</span>

<span class="cp"># 添加环境到app中</span>
<span class="n">ks</span> <span class="n">env</span> <span class="n">add</span> <span class="o">&lt;</span><span class="n">env</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">flags</span><span class="p">]</span>

<span class="n">ks</span> <span class="n">env</span> <span class="n">add</span> <span class="n">prod</span> <span class="o">--</span><span class="n">server</span><span class="o">=</span><span class="n">https</span><span class="o">:</span><span class="c1">//ksonnet-1.us-west.elb.amazonaws.com</span>




<span class="n">ks</span> <span class="n">env</span> <span class="n">current</span>
<span class="n">ks</span> <span class="n">env</span> <span class="n">describe</span>

<span class="n">ks</span> <span class="n">env</span> <span class="n">list</span>
<span class="n">ks</span> <span class="n">env</span> <span class="n">rm</span>
<span class="n">ks</span> <span class="n">env</span> <span class="n">set</span>
<span class="n">ks</span> <span class="n">env</span> <span class="n">target</span>
<span class="n">ks</span> <span class="n">env</span> <span class="n">update</span>
</pre></div>


<ul>
<li>使用<code>ks param</code>定制环境</li>
</ul>
<div class="hlcode"><pre><span class="n">ks</span> <span class="n">param</span> <span class="n">list</span>

<span class="n">ks</span> <span class="n">param</span> <span class="n">set</span>
</pre></div>


<ul>
<li>比较环境</li>
<li><code>ks diff</code></li>
<li><code>ks param diff</code></li>
</ul>
<h2 id="37">3.7. 其他</h2>
<div class="hlcode"><pre><span class="err">#</span> <span class="nx">查看值指定</span><span class="o">&lt;</span><span class="nb">env</span><span class="o">&gt;</span><span class="nx">环境下的配置文件</span>
<span class="nx">ks</span> <span class="nx">show</span> <span class="o">&lt;</span><span class="nb">env</span><span class="o">&gt;</span> <span class="err">[</span><span class="na">-c</span> <span class="o">&lt;</span><span class="nb">component</span><span class="na">-filename</span><span class="o">&gt;</span><span class="cp">]</span> <span class="cp">[</span><span class="nx">flags</span><span class="cp">]</span>

# Show all of the components for the &#39;dev&#39; environment, in YAML
# (In other words, expands all manifests in the components/ directory)
ks show dev

# Show a single component from the &#39;prod&#39; environment, in JSON
ks show prod -c redis -o json

# Show multiple components from the &#39;dev&#39; environment, in YAML
ks show dev -c redis -c nginx-server
</pre></div>


<ul>
<li>Import a manifest</li>
<li>
<p><code>ks import</code></p>
</li>
<li>
<p>Validate manifests against the Kubernetes API</p>
</li>
<li>
<p><code>ks validate</code></p>
</li>
<li>
<p>View metadata about the ksonnet binary</p>
</li>
<li><code>ks version</code></li>
</ul>
<h2 id="38-github">3.8. Github限速错误</h2>
<p>如果您遇到错误，请说出某种效果，403 API rate limit of 60 still exceeded您可以通过获取Github个人访问令牌并将其设置为ks可以使用的方式来解决。Github对经过身份验证的用户的速率限制要高于未经身份验证的用户。</p>
<p>转到https://github.com/settings/tokens并生成一个新令牌。只需进行身份验证，就不必授予任何访问权限。<br />
确保您将令牌保存在某个地方，因为您无法再次看到它。如果丢失，则必须删除并创建一个新的。<br />
在您的shell中设置环境变量：export GITHUB_TOKEN=<token>。您可能希望将其作为您的Shell启动脚本（即.profile）的一部分。</p>
<div class="hlcode"><pre>echo &quot;export GITHUB_TOKEN=<span class="cp">${</span><span class="n">GITHUB_TOKEN</span><span class="cp">}</span>&quot; &gt;&gt; ~/.bashrc
export GITHUB_TOKEN=<span class="cp">${</span><span class="n">GITHUB_TOKEN</span><span class="cp">}</span>
</pre></div>


<h1 id="4">4. 参考资料</h1>
<ol>
<li><a href="https://github.com/ksonnet/ksonnet/blob/master/docs/cli-reference/README.md">Command line reference</a></li>
</ol>
<div class="footnote">
<hr />
<ol>
<li id="fn:2">
<p><a href="https://github.com/ksonnet/ksonnet/blob/master/docs/cli-reference/ks_init.md">ks init</a>&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p><a href="https://github.com/ksonnet/ksonnet/blob/master/docs/concepts.md#application">Concept Reference</a>&#160;<a class="footnote-backref" href="#fnref:3" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
</div>
<div id="renote">
  <HR style=" FILTER: alpha (opacity = 100, finishopacity =0 , style= 3 )" width="80%" color=#987 cb 9 SIZE=3>
  <p>如果你觉得这篇文章对你有帮助，不妨请我喝杯咖啡，鼓励我创造更多!</p>
  <img src="/Wiki/static/images/pay.jpg" width="25%">
</div>

    </div>
    <div id="footer">
        <span>
            Copyright © 2020 zhang787jun.
            Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        </span>
    </div>

    
</body>
<script>
    function changeImgurl(site_root_url) {
        var images = document.images;
        var site_root = site_root_url;
        for (i = 0, len = images.length; i < len; i++) {
            image = images[i];
            image_src = image.src;
            if (image_src.search("attach") >= 0) {
                re_image_src = image_src.slice(image_src.search("attach"));
                abs_image_src = (site_root.endsWith("/")) ? site_root + re_image_src : site_root + "/" +
                    re_image_src;
                image.src = abs_image_src;
            }
        }
    }
    var site_root_url = "/Wiki";
    changeImgurl(site_root_url);
    let isMathjaxConfig = false; // 防止重复调用Config，造成性能损耗
    const initMathjaxConfig = () => {
        if (!window.MathJax) {
            return;
        }
        window.MathJax.Hub.Config({
            showProcessingMessages: false, //关闭js加载过程信息
            messageStyle: "none", //不显示信息
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [["$", "$"], ["\\(", "\\)"]], //行内公式选择符
                displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
                skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
            },
            "HTML-CSS": {
                availableFonts: ["STIX", "TeX"], //可选字体
                showMathMenu: false //关闭右击菜单显示
            }
        });
        isMathjaxConfig = true; //
    };
    if (isMathjaxConfig === false) {
        // 如果：没有配置MathJax
        initMathjaxConfig();
    };
</script>

</html>